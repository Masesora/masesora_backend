
- Qu√© es MASESORA de verdad (identidad y promesa).
- C√≥mo est√° construido por dentro (componentes).
- El flujo de trabajo, fase a fase, paso a paso, con actores, datos y decisiones.
üß© VISI√ìN COMPLETA DEL PROYECTO (BACKEND MAS@FRAME)(Esto es un mapa maestro: t√©cnico, cl√≠nico y operativo. Tu referencia total.)1. Identidad y promesa de MASESORAMASESORA es una cl√≠nica de empresas que lleva a una organizaci√≥n desde una empresa en crisis, desordenada, sin control ni liquidez, hasta alcanzar una empresa resiliente, con continuidad operativa, caja blindada y excelencia sistematizada, mediante un sistema que combina:- escaner de salud empresarial
- diagn√≥stico cl√≠nico empresarial,
- decisiones operativas guiadas,
- herramientas concretas de intervenci√≥n,
- y validaci√≥n cuantitativa antes/despu√©s con garant√≠a.
No es un ‚Äúsoftware de KPIs‚Äù ni un ‚ÄúERP de consultor√≠a‚Äù. Es:- Un m√©todo cl√≠nico codificado: 10 especialidades √ó 10 s√≠ntomas = 100 ‚Äúenfermedades‚Äù empresariales claramente definidas, cada una con su tratamiento.
- Una m√°quina de decisiones: el ACI nunca se queda en blanco; siempre sabe qu√© hacer, con qu√© herramienta y qu√© impacto se busca.
- Un sistema de garant√≠a: los datos se definen para que la mejora sea medible, defendible. La promesa al cliente:
‚ÄúSi aplicas el tratamiento que define MASESORA, tus KPIs mejoran; si no mejoran, la responsabilidad queda trazable (datos, acciones, evidencias, colaboraci√≥n).‚Äù
2. Arquitectura funcional del sistema MASESORA2.1 Estructura operativa visible para el usuario (las 4 pesta√±as)- Pesta√±a 0 ‚Äì Control y contrato
- Gesti√≥n de roles: Optimizador (CC), ACI, cliente.
- Activaci√≥n de planes (PIE, PRE) por especialidad.
- Gesti√≥n de contratos, pagos y garant√≠as.
- Configuraci√≥n de qu√© m√≥dulos y s√≠ntomas est√°n disponibles para cada cliente.
- Pesta√±a 1 ‚Äì Diagn√≥stico inicial y foto cl√≠nica
- El ACI introduce los inputs iniciales por s√≠ntoma.
- El sistema calcula KPI inicial y resulta el estado cl√≠nico (rojo/√°mbar/verde/elite), y una narrativa.
- Se ve el mapa de salud empresarial inicial por especialidad y s√≠ntoma.
- Se identifica qu√© s√≠ntomas requieren tratamiento.
- Pesta√±a 2 ‚Äì Tratamiento (FRAME: las herramientas MASESORA)
- Para cada s√≠ntoma con necesidad de tratamiento, el sistema muestra:
- Decisi√≥n cl√≠nica (‚Äúqu√© hay que hacer‚Äù).
- Acci√≥n operativa (‚Äúc√≥mo se hace en la empresa‚Äù).
- Herramienta MASESORA (‚Äúcon qu√© plantilla / instrumento concreto‚Äù).
- El ACI:
- aplica "accion" con la "herramienta", y le lleva a la "toma decisiones"
- Pesta√±a 3 ‚Äì Validaci√≥n, resultado y Sello S10
- Tras el periodo de trabajo (ej. 6 semanas), el ACI y el CC se re√∫nen e introducen inputs revisados.
- El sistema recalcula KPIs, compara antes/despu√©s y muestra:
- mejora o empeoramiento,
- impacto cuantitativo,
- cumplimiento o no de los criterios de garant√≠a.
(AQUI NECESITAMOS AMPLIAR EXACTAMENTE COMO FUNCIONA EL TRATAMIENTO)
2.2 Especialidades, Departamentos, S√≠ntomas y Planes- **Especialidades y departamentos "UCI FINANCIERA": "FINANZAS", "UNIDAD DE PROCESOS": "PROCESOS", "CARDIOLOGIA COMERCIAL": "COMERCIAL", "NEUROLOGIA ESTRAT√âGICA": "ESTRAT√âGIA", "GESTION CLINICA": "GESTION", "CIRUJIA DE MARCA": "MARCA", "PSIQUIATR√çA ORGANIZACIONAL": "ORGANIZACIONAL", "RESCATE DEPERSONAS": "PERSONAS", "TERAPIA DE EXPERIENCIA": "EXPERIENCIA", "EXCELENCIA OPERATIVA": "EXCELENCIA" "EXCELENCIA" ]
- S√≠ntomas (S1‚ÄìS10 por especialidad):
- Cada s√≠ntoma es:
- una ‚Äúpatolog√≠a‚Äù concreta (‚ÄúHemorragia de Caja‚Äù, ‚ÄúDependencia del Due√±o‚Äù, ‚ÄúCuellos de Botella‚Äù, etc.),
- con inputs, f√≥rmula, umbrales y herramientas asociadas.
- Planes comerciales:
- PIE: intervenci√≥n m√≠nima pero potente ‚Äî 3 s√≠ntomas cr√≠ticos por especialidad.
- PRE: intervenci√≥n completa ‚Äî los 10 s√≠ntomas por especialidad.
- Roles:
- Optimizador / Consultor Certificado: dise√±a el contrato, asigna ACI, hace seguimiento del progreso del ACI en el sistema, da de alta y certifica.
- ACI: ejecuta el tratamiento dentro de la empresa, alimenta el sistema con datos y acciones.
- Cliente (empresa): ve resultados, contratos y altas.
- Admin (Masesora): asigna Optimizador (Consultor Certificado) a un cliente. Asigna planes (pagados) al cliente y acceso al sistema.
2.3 Modelo cl√≠nico-datos de un s√≠ntomaCada s√≠ntoma se codifica como una unidad cl√≠nica con:- Identidad:
- id (p.ej. FIN-S1, OPE-S3, TER-S1),
- name (nombre de la patolog√≠a),
- specialty (finanzas, excelencia, etc.),
- domain (sub-√°rea: liquidez, continuidad, flujo, etc.),
- plan (PIE/PRE).
- Modelo de c√°lculo:
- Inputs definidos para el ACI:
- input_a, input_b, etc.,
- definidos con precisi√≥n para que no rompan la garant√≠a:
- ej. ‚Äúingresos promedio 3 √∫ltimos meses‚Äù, ‚Äúgastos fijos promedio‚Äù.
- F√≥rmula KPI clara (ej. input_a / input_b, √≠ndices, ratios, etc.).
- Modelo cl√≠nico:
- kpi_value: resultado num√©rico.
- diagnosis.state: critical / recommended / optimizer / elite.
- diagnosis.treatment_required: true/false (¬øhay que intervenir?).
- Modelo de tratamiento:
- treatment_code: referencia a la herramienta.
- treatment: descripci√≥n de la intervenci√≥n (decisi√≥n + acci√≥n).
- master_treatment: integraci√≥n con un plan m√°s global (por m√≥dulo o por empresa).
- Modelo de narrativa:
- Texto que explica:
- qu√© significa el KPI,
- en qu√© estado est√° la empresa,
- qu√© se va a hacer,
- qu√© se espera lograr.
- Modelo de progreso (antes/despu√©s):
- progress.kpi_before, progress.kpi_after.
- progress.impact.raw_text: relato del impacto conseguido.
- Campos para vincular acciones y herramientas usadas.
2.4 Arquitectura t√©cnica alineada con esto
- Backend:
  - Endpoints ‚Äúde negocio‚Äù (clientes, planes, ACIs, contratos, dashboard).  
  - Motor cl√≠nico (s√≠ntomas, KPIs, estados, narrativas, antes/despu√©s).
- Frontend:
  - Implementa las 4 pesta√±as.
  - Se alimenta del motor cl√≠nico y de los endpoints de negocio.  
- Base de datos:
  - `clients`, `plans`, `acis`, `specialities`, `symptoms`,  
  - `symptom_data` (datos iniciales y revisados por cliente/s√≠ntoma),  
  - `evidences` (trabajo real),  
  - `contracts` (estado jur√≠dico y econ√≥mico).
3. Flujo de trabajo detallado del sistema MASESORA
Fase 1: Esc√°ner y decisi√≥n de intervenci√≥n (antes del SaaS ‚Äúde uso diario‚Äù)
**Objetivo:** decidir d√≥nde intervenir, cu√°nto intervenir y con qu√© plan (PIE/PRE).
1. **Esc√°ner de salud empresarial** HERRAMIENTA EXTERNA que aplica un cuestionario  y su resultado identifica las **especialidades** donde hay s√≠ntomas que hay que tratar. TRAS PRESUPUESTO, CLIENTE PAGA LOS PLANES ELEGIDOS. 
 
2. **Propuesta de intervenci√≥n**
   - Actores: Admin da acceso al cliente a los planes comprados y asigna Optimizador. 
   - **Acci√≥n:** traduce el esc√°ner en una propuesta de especialidades a trabajar,
     - plan PIE o PRE en cada una. Ejemplo:   
     - Finanzas: PRE (10 s√≠ntomas).  
     - Procesos: PIE (3 s√≠ntomas).  
     - Personas: PIE (3 s√≠ntomas).

3. **Definici√≥n de contrato y garant√≠a**
   - **Actor:** Optimizador.  
   - **Acci√≥n:** configura:
     - qu√© se incluye,  
     - qu√© se promete,  
     - qu√© se mide,  
     - en qu√© plazo.  
   - **Resultado esperado:** documento de contrato con cl√°usula de garant√≠a y definici√≥n de qu√© se considerar√° ‚Äúmejora verificable‚Äù.

> Esta fase a√∫n no est√° 100% en el backend, pero es el contexto l√≥gico de /api/clients, /api/plans, /api/contracts.
Fase 2: Onboarding en la plataforma (Pesta√±a 0)
**Objetivo:** preparar el entorno digital para que el ACI pueda trabajar.
4. **Creaci√≥n de cliente en el sistema**
   - **Actor:** Optimizador.  
   - **Acci√≥n:** crea el cliente en `/api/clients`.  
   - **Datos clave:**  
     - datos de la empresa,  
     - optimizador responsable (CC),  
     - contacto principal
     - pagado: s√≠/no,  


5. **Configuraci√≥n de planes y especialidades**
   - **Actor:** Admin.  
   - **Acci√≥n:** en `/api/plans` y `/api/modules`, asigna:
     - especialidades activas (finanzas, procesos, etc.),  
     - plan PIE/PRE para cada una.  
   - **Resultado:** el sistema sabe qu√© s√≠ntomas se van a evaluar para ese cliente.

6. **Asignaci√≥n de ACI**
   - **Actor:** Optimizador.  
   - **Acci√≥n:** crea o asigna el ACI del cliente en `/api/acis`.  
   - **Permisos:** el ACI solo podr√° ver y trabajar sobre:
     - su empresa,  
     - las especialidades y s√≠ntomas contratados.

7. **Contrato **
   - **Actor:** Cliente (firma), Optimizador (emisi√≥n).  
   - **Acci√≥n:** se formaliza el contrato en `/api/contracts`:
     - firmado: s√≠/no,  
     - garant√≠a activa: s√≠/no.  
   - **Resultado:** acceso al sistema. 
Fase 3: Evaluaci√≥n inicial por s√≠ntomas (Pesta√±a 1)
**Objetivo:** construir la foto cl√≠nica inicial de la empresa, por s√≠ntoma.
8. **ACI entra a la pesta√±a 1 y ve los s√≠ntomas activos**
   - **Actor:** ACI.  
   - **Interfaz:** lista de m√≥dulos y s√≠ntomas disponibles (seg√∫n plan).  
   - **Ejemplo:**  
     - Finanzas ‚Äì S1 Hemorragia de Caja, S2 Infecci√≥n de Margen, etc.  
     - Excelencia ‚Äì S3 Falta de Continuidad Operativa, etc.

9. **ACI introduce inputs iniciales por s√≠ntoma**
   - **Actor:** ACI.  
   - **Acci√≥n:** para cada s√≠ntoma:
     - rellena los campos que el sistema pide (`input_a`, `input_b`, ‚Ä¶) con definiciones claras (ingresos promedio, stock medio, etc.).  
   - **Backend:** se env√≠a una request al motor cl√≠nico (`/clinical-eval` o batch) con:
     - `symptom_id`,  
     - `inputs`,  
     - `post_treatment: false`.

10. **El motor cl√≠nico calcula KPI y diagn√≥stico inicial**
    - **Backend:**  
      - `kpi_engine` aplica la f√≥rmula.  
      - `interpretation_engine` determina el estado (critical / recommended / optimizer / elite).  
      - se genera narrativa cl√≠nica m√≠nima:
        - ‚ÄúEl KPI actual indica un estado CR√çTICO dentro de X‚Ä¶‚Äù  
    - **Datos guardados:**  
      - en `symptom_data` se graban:
        - `kpi_before`,  
        - estado inicial,  
        - fecha,  
        - qui√©n (ACI).
11. **El sistema arma el mapa de salud inicial**
    - **Frontend (pesta√±a 1 / dashboard inicial):**
      - sem√°foros por s√≠ntoma,  
      - resumen por m√≥dulo,  
      - priorizaci√≥n de qu√© tratar primero (los rojos).
> Aqu√≠ es donde Swagger, hoy, ya entra: est√°s probando este c√°lculo y diagn√≥stico.
Fase 4: Tratamiento con herramientas MASESORA (Pesta√±a 2)
**Objetivo:** no solo medir, sino actuar y registrar el trabajo real.
12. **Identificaci√≥n de s√≠ntomas a tratar**
    - **Actor:** ACI + Optimizador (si quiere priorizar).  
    - los s√≠ntomas en estado(THRESHOLD) CRITICAL/RECOMMENDED/OPTIMIZED HACEN TRATAMIENTO. OPTIMIZED PUEDEN ELEGIR EL TRATAMIENTO MASTER 2.0 SI PREFIEREN.   

13. **El sistema propone decisiones, acciones y herramientas. Sera un artefacto visual atractivo para el ACi, intuitivo. 
    - **Backend:** cada s√≠ntoma tiene asociadas:
      - decisiones (‚Äúqu√© hacer‚Äù),  
      - acciones (‚Äúc√≥mo hacerlo‚Äù),  
      - herramientas (‚Äúcon qu√© instrumento‚Äù).  
    - **Ejemplo en Finanzas ‚Äì Hemorragia de Caja:**
      - Decisi√≥n: Priorizaci√≥n de pagos.  
      - Acci√≥n: Arqueo de caja y plan de cobro inmediato.  
      - Herramienta: Matriz de Tesorer√≠a.

14. **El ACI ejecuta y registra el tratamiento**
    - **Actor:** ACI.  
    - **Acciones:**
      - abre la herramienta (plantilla, matriz, hoja, lo que sea).  
      - realiza el trabajo con el cliente.  
      - registra:
        - qu√© decisi√≥n se tom√≥,  
        - qu√© acci√≥n se ejecut√≥,  
        - qu√© herramienta se us√≥,  
        - evidencias (archivos, fotos, PDFs, notas).  
    - **Backend:**  
      - `evidences` almacena las herramientas usadas y sus resultados.  
      - `symptom_data` se enriquece con informaci√≥n de tratamiento aplicado.

15. **Seguimiento intermedio** PREVIO PERMISO A ADMIN Y DE  FORMA Opcional: el sistema puede permitir recalcular KPIs intermedios si hay cambios relevantes en los inputs antes de la revisi√≥n final.

Fase 5: Revisi√≥n, Alta y Recomendaci√≥n (descuento otra especialidad) (Pesta√±a 3)
Objetivo:** demostrar, con datos, que el tratamiento ha funcionado (si o si).
16. **ACI introduce inputs revisados**
    - **Actor:** ACI y Optimizador
    - **Momento:** al cabo de X semanas de trabajo.  
    - **Acci√≥n:** para cada s√≠ntoma trabajado:
      - introduce la nueva foto (mismos inputs, nuevos valores).  
    - **Backend:** se env√≠a una request con:
      - `symptom_id`,  
      - `inputs_revised`,  
      - `post_treatment: true`.

17. **El motor cl√≠nico recalcula y compara**
    - **Backend:**  
      - recalcula `kpi_after`,  
      - compara con `kpi_before`,  
      - determina:
        - mejora, estancamiento o empeoramiento,  
        - estado cl√≠nico final.  
      - llena `progress`:
        - `kpi_before`, `kpi_after`,  
        - posible texto de impacto (‚ÄúSe ha mejorado X puntos, pasando de cr√≠tico a recomendado‚Ä¶‚Äù).

18. **El dashboard final muestra la historia cl√≠nica**
    - **Frontend (pesta√±a 3 / dashboard S10):**
      - comparativa antes/despu√©s por s√≠ntoma y m√≥dulo,  
      - visi√≥n agregada (por especialidad y empresa):  
        - % s√≠ntomas mejorados,  
        - % s√≠ntomas en verde,  
        - evoluci√≥n global.  

19. Alta y Recomendaci√≥n (descuento otra especialidad). Aplicaci√≥n de la garant√≠a y sello S10**    - **Actor:** Optimizador.  
    - **Acci√≥n:** revisa el dashboard,  
      - verifica si se han cumplido los criterios de garant√≠a (definidos en contrato).  
    - **Resultado:**
      - si s√≠ ‚Üí se activa el Sello S10 (y queda registrado en `contracts` / `clients`).  
      - si no ‚Üí se dispara la l√≥gica acordada (extensi√≥n, revisi√≥n, devoluci√≥n, etc.).
- si excellence: acceso al Club de Personas Excelentes. 


- qu√© parte del flujo ya podemos simular y validar en Swagger,  
- qu√© endpoints tocar,  
- con qu√© inputs,  
- y qu√© conclusiones sacar para el proyecto (no solo ‚Äúfunciona / no funciona‚Äù).
